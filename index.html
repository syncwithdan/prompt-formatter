<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ReplyBot ‚Äî Smart Response Generator</title>
  <meta name="description" content="ReplyBot: Generate clear, polite replies instantly. 12 response types ¬∑ 4 tones ¬∑ emoji toggle. No login. No AI required." />
  <style>
    :root{--bg:#0b0c10;--panel:#12151c;--ink:#e9edf1;--muted:#9aa3ad;--line:#1e2330;--brand:#7cd1ff;--accent:#39a2ff}
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif}
    .wrap{max-width:980px;margin:40px auto;padding:0 16px}
    h1{font-size:28px;margin:0 0 6px}
    p.sub{margin:0 0 20px;color:var(--muted)}
    .grid{display:grid;gap:14px;grid-template-columns:1fr 1fr}
    .grid-3{display:grid;gap:14px;grid-template-columns:1fr 1fr 1fr}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    select,input,textarea{width:100%;background:#0f131b;border:1px solid var(--line);color:var(--ink);border-radius:12px;padding:10px 12px;outline:none}
    textarea{min-height:110px;resize:vertical}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{cursor:pointer;background:#111827;border:1px solid var(--line);color:var(--ink);padding:10px 14px;border-radius:12px;font-weight:600}
    .btn.primary{background:linear-gradient(180deg,#1b2735,#0f172a);border-color:#1f2a3a}
    .btn.ghost{background:transparent;border:1px dashed var(--line);color:var(--muted)}
    .btn:active{transform:translateY(1px)}
    .badge{font-size:12px;color:#cfe8ff}
    .out{white-space:pre-wrap;line-height:1.55}
    .footer{color:var(--muted);font-size:12px;margin-top:18px}
    .pill{display:inline-flex;align-items:center;gap:8px;background:#0e1420;border:1px solid var(--line);padding:8px 10px;border-radius:999px}
    .switch{display:inline-flex;align-items:center;gap:6px}
    .switch input{accent-color:var(--accent)}
    .toast{position:fixed;bottom:18px;right:18px;background:#0d1420;border:1px solid var(--line);padding:10px 14px;border-radius:10px;opacity:0;transform:translateY(6px);transition:all .25s ease}
    .toast.show{opacity:1;transform:translateY(0)}
    a{color:var(--brand);text-decoration:none}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ReplyBot <span class="badge">v1</span></h1>
    <p class="sub">Sound right in every situation ‚Äî 12 reply types ‚Ä¢ 4 tones ‚Ä¢ emoji toggle ‚Ä¢ no AI required.</p>

    <div class="card" style="margin-bottom:14px">
      <div class="grid">
        <div>
          <label for="incoming">(Optional) Incoming message</label>
          <textarea id="incoming" placeholder="Paste the message you received (optional)"></textarea>
        </div>
        <div>
          <div class="grid-3">
            <div>
              <label for="rtype">Reply type</label>
              <select id="rtype"></select>
            </div>
            <div>
              <label for="tone">Tone</label>
              <select id="tone">
                <option value="formal">Formal</option>
                <option value="friendly">Friendly</option>
                <option value="calm">Calm</option>
                <option value="confident">Confident</option>
              </select>
            </div>
            <div>
              <label>Options</label>
              <div class="pill switch"><input type="checkbox" id="emoji" /> <span>Emoji</span></div>
            </div>
          </div>

          <div class="grid-3" style="margin-top:14px">
            <div>
              <label for="recipient">Recipient</label>
              <input id="recipient" placeholder="e.g., John" />
            </div>
            <div>
              <label for="timeframe">Timeframe</label>
              <input id="timeframe" placeholder="e.g., 4 PM today" />
            </div>
            <div>
              <label for="sender">Sender</label>
              <input id="sender" placeholder="Your name" />
            </div>
          </div>
          <div class="grid" style="margin-top:14px">
            <div>
              <label for="reason">Reason (optional)</label>
              <input id="reason" placeholder="Short reason (keeps it human)" />
            </div>
            <div>
              <label for="offer">Offer / Alternative (optional)</label>
              <input id="offer" placeholder="e.g., share a shorter version" />
            </div>
          </div>

          <div class="row" style="margin-top:14px">
            <button class="btn primary" id="gen">Generate Reply</button>
            <button class="btn" id="variant">Randomize Variant</button>
            <button class="btn ghost" id="clear">Clear</button>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <label>Generated reply</label>
      <div id="output" class="out"></div>
      <div class="row" style="margin-top:12px">
        <button class="btn" id="copy">Copy to Clipboard</button>
        <button class="btn ghost" id="sharewa">Share via WhatsApp</button>
        <button class="btn ghost" id="email">Open in Email</button>
      </div>
      <div class="footer">Tip: tweak <em>timeframe</em> or <em>reason</em> to make it feel personal. ReplyBot runs fully offline in your browser.</div>
    </div>

    <div class="footer" style="margin-top:12px">Made with ‚ù§Ô∏è ‚Äî <a href="https://github.com/" target="_blank" rel="noreferrer">Host on GitHub Pages</a></div>
  </div>

  <div class="toast" id="toast">Copied!</div>

<script>
// ========= Tone profiles =========
const TONES = {
  formal:    { greeting:"Hello", signoff:"Regards", emoji:false, prefaces:["Thanks for the follow‚Äëup.", "Noted."] },
  friendly:  { greeting:"Hey",   signoff:"Cheers",  emoji:true,  prefaces:["Thanks for the nudge!", "All good!"] },
  calm:      { greeting:"Hi",    signoff:"Thanks",  emoji:false, prefaces:["I understand.", "Let‚Äôs take this step by step."] },
  confident: { greeting:"Hi",    signoff:"‚Äî",       emoji:false, prefaces:["Here‚Äôs the plan.", "I‚Äôll handle it."] }
};

// ========= 12 reply types with variants =========
const TEMPLATES = {
  acknowledge: {
    label: "‚úÖ Confirm & Commit",
    defaults: { timeframe:"this evening" },
    variants: [
      "{{greeting}} {{recipient}}, got it. I‚Äôll share it by {{timeframe}}. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}} ‚Äî noted. I‚Äôll update you by {{timeframe}}. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}}! On it. Expect it by {{timeframe}}. {{signoff}}, {{sender}}"
    ]
  },
  apologize: {
    label: "üôè Apologize & Reassure",
    defaults: { timeframe:"today" },
    variants: [
      "{{greeting}} {{recipient}}, apologies for the delay ‚Äî I‚Äôll share it by {{timeframe}}. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}} ‚Äî sorry about the miss. I‚Äôm finalizing and will send soon. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}}, thanks for your patience. I‚Äôm correcting it now and will revert shortly. {{signoff}}, {{sender}}"
    ]
  },
  clarify: {
    label: "‚ùì Ask for Clarification",
    defaults: {},
    variants: [
      "{{greeting}} {{recipient}} ‚Äî quick check: do you need the full pack or just the summary? {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}}, could you confirm which version you meant? {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}}. Before I proceed, what exact timeline do you have in mind? {{signoff}}, {{sender}}"
    ]
  },
  delay: {
    label: "‚è∞ Need More Time",
    defaults: { timeframe:"tomorrow" },
    variants: [
      "{{greeting}} {{recipient}}, I‚Äôll need until {{timeframe}} to wrap this properly. {{reason}} {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}} ‚Äî quick heads‚Äëup: I‚Äôll share it by {{timeframe}}. {{reason}} {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}}. To keep quality high, I‚Äôll revert by {{timeframe}}. {{signoff}}, {{sender}}"
    ]
  },
  decline: {
    label: "üö´ Decline Politely",
    defaults: { offer:"revisit next week" },
    variants: [
      "{{greeting}} {{recipient}}, I appreciate the ask, but I‚Äôll have to pass this time. If helpful, I can {{offer}}. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}} ‚Äî I won‚Äôt be able to commit right now. Alternatively, I can {{offer}}. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}}. I have to decline this request; happy to {{offer}}. {{signoff}}, {{sender}}"
    ]
  },
  boundary: {
    label: "üß± Set Boundary / Push Back",
    defaults: { timeframe:"tomorrow" , offer:"share a shorter version"},
    variants: [
      "{{greeting}} {{recipient}}, that timeline isn‚Äôt feasible. What I can do is {{offer}} by {{timeframe}}. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}} ‚Äî this is outside my current scope. I can {{offer}} instead. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}}. I can‚Äôt take that up immediately; I can deliver by {{timeframe}}. {{signoff}}, {{sender}}"
    ]
  },
  deescalate: {
    label: "ü§ù De‚Äëescalate & Calm",
    defaults: { next_step:"I‚Äôll sort this and keep you posted." },
    variants: [
      "{{greeting}} {{recipient}}, I hear you and I get the concern. {{next_step}} {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}} ‚Äî understood. Let‚Äôs fix this step by step. {{next_step}} {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}}. Sorry this caused frustration. I‚Äôll help resolve it smoothly. {{signoff}}, {{sender}}"
    ]
  },
  thanks: {
    label: "‚ù§Ô∏è Appreciation",
    defaults: {},
    variants: [
      "{{greeting}} {{recipient}}, thanks a lot ‚Äî really helpful! {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}} ‚Äî appreciate the quick turnaround. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}}. Grateful for your input; it improved the result. {{signoff}}, {{sender}}"
    ]
  },
  followup: {
    label: "üîî Follow‚Äëup / Nudge",
    defaults: {},
    variants: [
      "{{greeting}} {{recipient}} ‚Äî just checking if you got a chance to review? {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}}, gentle reminder on the earlier note. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}}. Any update on this when you get a moment? {{signoff}}, {{sender}}"
    ]
  },
  update: {
    label: "üì¢ Share Update / Progress",
    defaults: { next_step:"I‚Äôll send the final shortly." },
    variants: [
      "{{greeting}} {{recipient}}, quick update: the draft is 70% done ‚Äî {{next_step}} {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}} ‚Äî almost there; verifying data and then sharing. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}}. All set on my side; waiting for one confirmation. {{signoff}}, {{sender}}"
    ]
  },
  fbappreciate: {
    label: "üìù Appreciate Feedback",
    defaults: {},
    variants: [
      "{{greeting}} {{recipient}}, appreciate the feedback ‚Äî I‚Äôll review and refine. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}} ‚Äî thanks for sharing that candidly. I‚Äôll incorporate it. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}}. That‚Äôs helpful input; I‚Äôll factor it into the next version. {{signoff}}, {{sender}}"
    ]
  },
  transition: {
    label: "üîÑ Transition / Move Forward",
    defaults: {},
    variants: [
      "{{greeting}} {{recipient}}, perfect ‚Äî that covers it. Let‚Äôs proceed accordingly. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}} ‚Äî noted. Moving ahead on this. {{signoff}}, {{sender}}",
      "{{greeting}} {{recipient}}. All clear on my end. Let‚Äôs wrap this up. {{signoff}}, {{sender}}"
    ]
  }
};

// ========= Utilities =========
const $ = sel => document.querySelector(sel);
const fmt = (s, map) => s.replace(/\{\{(.*?)\}\}/g, (_,k)=> (map[k.trim()] ?? ""));
const pick = arr => arr[Math.floor(Math.random()*arr.length)];

function analyze(msg){
  const m = (msg||"").toLowerCase();
  return {
    urgency: /\basap\b|now|urgent|!!!|\bimmediately\b/.test(m),
    blame: /you didn\'t|again|late|why|\?\?/.test(m),
    negative: /annoyed|angry|frustrated|issue|problem|delay|late/.test(m)
  };
}

function microGrammar(text, {emojiOn=false, tone}){
  // a/an rule
  text = text.replace(/\b(a)\s+([aeiouAEIOU])/g, 'an $2');
  // tidy spaces
  text = text.replace(/\s+/g,' ').replace(/\s([.,!?])/g,'$1');
  // end punctuation
  if(!/[.!?]$/.test(text)) text += '.';
  // one emoji max if allowed
  if(emojiOn){
    const em = tone==='friendly' ? ' üôÇ' : (tone==='empathetic' ? ' üôè' : ' üëç');
    // append to first sentence only
    text = text.replace(/(\.|!|\?)\s/, `$1${em} `);
  }
  return text.trim();
}

function suggestTime(){
  // e.g., nearest upcoming hour today
  const d = new Date();
  d.setMinutes(0,0,0); d.setHours(d.getHours()+1);
  const opts = {hour:'numeric', minute:undefined};
  return d.toLocaleTimeString([], opts) + " today";
}

let lastVariantIndex = 0;

function generate({type, tone, fields, incoming}){
  const t = TEMPLATES[type];
  if(!t) return "";
  const style = TONES[tone] || TONES.formal;
  const ctx = analyze(incoming);

  // pick variant (stable unless user clicks Randomize)
  const variant = t.variants[lastVariantIndex % t.variants.length];

  const defaults = Object.assign({}, t.defaults);
  const slots = Object.assign(defaults, fields);

  // urgency helper
  if(ctx.urgency && !slots.timeframe){ slots.timeframe = suggestTime(); }

  // Base map
  let map = {
    greeting: style.greeting,
    recipient: slots.recipient || "",
    timeframe: slots.timeframe || "",
    reason: slots.reason ? (slots.reason.endsWith('.')? slots.reason : slots.reason + '.') : "",
    offer: slots.offer || "",
    next_step: slots.next_step || "",
    signoff: style.signoff,
    sender: slots.sender || ""
  };

  // Preface for blame/negative in certain types
  let preface = "";
  if((type==='deescalate' || type==='apologize' || type==='delay') && (ctx.blame || ctx.negative)){
    preface = pick(style.prefaces) + ' ';
  }

  let text = preface + fmt(variant, map);
  text = microGrammar(text, {emojiOn: !!fields.emojiOn && (style.emoji || tone==='friendly'), tone});
  return text;
}

function populateTypes(){
  const rtype = $('#rtype');
  Object.entries(TEMPLATES).forEach(([k,v])=>{
    const opt = document.createElement('option');
    opt.value = k; opt.textContent = v.label; rtype.appendChild(opt);
  });
}

function readFields(){
  return {
    recipient: $('#recipient').value.trim(),
    timeframe: $('#timeframe').value.trim(),
    sender: $('#sender').value.trim(),
    reason: $('#reason').value.trim(),
    offer: $('#offer').value.trim(),
    emojiOn: $('#emoji').checked
  };
}

function render(){
  const type = $('#rtype').value;
  const tone = $('#tone').value;
  const fields = readFields();
  const incoming = $('#incoming').value;
  const out = generate({type, tone, fields, incoming});
  $('#output').textContent = out;
  // persist basic prefs
  localStorage.setItem('replybot_prefs', JSON.stringify({type,tone,emoji:fields.emojiOn}));
}

function showToast(msg){
  const t = $('#toast'); t.textContent = msg || 'Copied!'; t.classList.add('show');
  setTimeout(()=> t.classList.remove('show'), 1200);
}

function copy(){
  const txt = $('#output').textContent.trim();
  if(!txt) return;
  navigator.clipboard.writeText(txt).then(()=> showToast('Copied!'));
}

function shareWA(){
  const txt = encodeURIComponent($('#output').textContent.trim());
  if(!txt) return;
  window.open('https://wa.me/?text='+txt, '_blank');
}

function openEmail(){
  const sub = encodeURIComponent('Quick reply');
  const body = encodeURIComponent($('#output').textContent.trim());
  window.location.href = `mailto:?subject=${sub}&body=${body}`;
}

function restore(){
  populateTypes();
  const saved = JSON.parse(localStorage.getItem('replybot_prefs')||'{}');
  if(saved.type && TEMPLATES[saved.type]) $('#rtype').value = saved.type;
  if(saved.tone) $('#tone').value = saved.tone;
  if(saved.emoji!==undefined) $('#emoji').checked = saved.emoji;
  render();
}

// ========= Events =========
$('#gen').addEventListener('click', ()=> { render(); });
$('#variant').addEventListener('click', ()=> { lastVariantIndex = (lastVariantIndex+1)%5; render(); });
$('#copy').addEventListener('click', copy);
$('#sharewa').addEventListener('click', shareWA);
$('#email').addEventListener('click', openEmail);
$('#clear').addEventListener('click', ()=>{
  ['incoming','recipient','timeframe','sender','reason','offer'].forEach(id=> $('#'+id).value='');
  render();
});
['rtype','tone','emoji','recipient','timeframe','sender','reason','offer','incoming'].forEach(id=>{
  document.addEventListener('input', (e)=>{
    if(e.target && e.target.id===id){ /* live updates optional */ }
  });
});

// init
restore();
</script>
</body>
</html>
